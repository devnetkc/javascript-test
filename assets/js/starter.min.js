const Employees=[{internalid:"1",name:"Abe Anderson",email:"aanderson@javascript.com",birthdate:"9/25/1974",supervisor:"3","2012 Revenue":"100000.00","2013 Revenue":"0.00"},{internalid:"2",name:"Bob Benson",email:"bbenson@javascript.com",birthdate:"7/13/1972",supervisor:"3","2012 Revenue":"150000.00","2013 Revenue":"0.00"},{internalid:"3",name:"Chelsea Chastain",email:"cchastain@javascript.com",birthdate:"5/7/1968",supervisor:"","2012 Revenue":"375000.00","2013 Revenue":"0.00"},{internalid:"4",name:"Dwight Dwyer",email:"ddwyer@javascript.com",birthdate:"8/23/1982",supervisor:"3","2012 Revenue":"125000.00","2013 Revenue":"0.00"},{internalid:"5",name:"Eathon Eckhart",email:"eeckhart@javascript.com",birthdate:"11/28/1970",supervisor:"","2012 Revenue":"200000.00","2013 Revenue":"0.00"}],Revenue2013=[{type:"invoice",customer:"Franklin",Employee:"1",amount:"50000.00"},{type:"invoice",customer:"Gabby",Employee:"1",amount:"25000.00"},{type:"invoice",customer:"Harry",Employee:"1",amount:"30000.00"},{type:"invoice",customer:"Ingrid",Employee:"2",amount:"75000.00"},{type:"invoice",customer:"Jacob",Employee:"2",amount:"60000.00"},{type:"invoice",customer:"Kelly",Employee:"4",amount:"30000.00"},{type:"invoice",customer:"Lamar",Employee:"4",amount:"40000.00"},{type:"invoice",customer:"Mary",Employee:"4",amount:"20000.00"},{type:"invoice",customer:"Nicole",Employee:"4",amount:"70000.00"},{type:"invoice",customer:"Oscar",Employee:"5",amount:"75000.00"},{type:"invoice",customer:"Patrick",Employee:"5",amount:"80000.00"},{type:"invoice",customer:"Quin",Employee:"5",amount:"60000.00"},{type:"invoice",customer:"Rachel",Employee:"5",amount:"100000.00"}],CommissionRules=[{employee:"1",percentage:"15%",bonus:"2000.00"},{employee:"2",percentage:"10%",bonus:"3000.00"},{employee:"3",percentage:"7.5%",bonus:"5000.00"},{employee:"4",percentage:"10%",bonus:"3000.00"},{employee:"5",percentage:"10%",bonus:"3000.00"}];import"../../node_modules/jquery/dist/jquery.min.js";import"../../node_modules/bootstrap/js/dist/util.js";import"../../node_modules/bootstrap/js/dist/modal.js";const UpdateEmpRecs=async year=>{const CurDate=new Date("1/1/2014"),CurYear=CurDate.getFullYear(),CurMonth=CurDate.getMonth()+1;let managerSaleTotals={supervisor:{3:{amount:0}}};for(const Emp of Employees)try{const Results=await Promise.all([Q1_CalcDaysToBDay(Emp,{CurDate:CurDate,CurMonth:CurMonth,CurYear:CurYear}),Q2_SetBestCustomer(Emp,year)]);Emp.daystobday=Results[0],Emp.bestcustomer=Results[1];const Supervisor=Emp.supervisor;try{""!==Supervisor&&(managerSaleTotals.supervisor[Supervisor].amount+=Number(Emp[year]))}catch(err){}}catch(err){}const Managers=Employees.filter(emp=>{for(const Manager in managerSaleTotals.supervisor){if(!managerSaleTotals.supervisor.hasOwnProperty(Manager))return!1;if(""===emp.supervisor)return!0}});Managers.some(manager=>{const ManagerId=manager.internalid;return!!managerSaleTotals.supervisor.hasOwnProperty(ManagerId)&&(manager[year]=managerSaleTotals.supervisor[ManagerId].amount.toFixed(2),!0)})},Q2_SetBestCustomer=async(emp,year)=>{try{const EmpSales=Revenue2013.filter(sale=>sale.Employee==emp.internalid);if(UpdateSalesTotals(year,EmpSales,emp),EmpSales.length<=0)return"N/A";const BestSale=EmpSales.reduce((previousValue,currentValue)=>{const MaxNum=Math.max(Number(previousValue.amount),Number(currentValue.amount));return MaxNum==currentValue.amount?currentValue:previousValue},{amount:0});return BestSale.customer}catch(err){}},Q1_CalcDaysToBDay=async(emp,current)=>{const BirthDate=new Date(emp.birthdate),BirthDay=BirthDate.getDate(),BirthMonth=BirthDate.getMonth()+1,NextBDayYear=BirthMonth>current.CurMonth?current.CurYear:current.CurYear+1,NextBDay=new Date(`${BirthMonth}/${BirthDay}/${NextBDayYear}`);return Math.ceil((NextBDay.getTime()-current.CurDate.getTime())/864e5)},UpdateSalesTotals=(year,sales,emp)=>(emp[year]=sales.reduce((prevSale,curSale)=>({amount:prevSale.amount?Number(prevSale.amount)+Number(curSale.amount):Number(curSale.amount)}),{amount:0}).amount.toFixed(2),emp[year]),RenderResults=(content,selector)=>{$(selector).html(JSON.stringify(content,null,"\t"))};(async()=>{if(await UpdateEmpRecs("2013 Revenue"),"complete"===document.readyState)return RenderResults(Employees,"pre#pre1");$(document).ready((function(){RenderResults(Employees,"pre#pre1")}))})();